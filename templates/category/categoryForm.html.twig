{% extends 'base.html.twig' %}

{% block title %}
    Crear categoría
{% endblock %}

{% block stylesheets %}
    <style>

        .page-header{
            margin-bottom:30px;
        }

        .page-title{
            font-size:2rem;
            font-weight:800;
        }

        .page-subtitle{
            color:var(--text-secondary);
        }

        /* layout principal */

        .category-layout{
            display:grid;
            grid-template-columns: 320px 1fr;
            gap:30px;
        }

        /* panel izquierdo */

        .category-panel{
            background:var(--bg-card);
            border:1px solid var(--border-color);
            border-radius:14px;
            padding:20px;
            height:fit-content;
        }

        .form-label{
            font-weight:600;
            margin-bottom:6px;
        }

        .form-control{
            background:var(--bg-secondary);
            border:1px solid var(--border-color);
            color:white;
        }

        .form-control::placeholder{
            color:#9ca3af;
        }

        .form-control:focus{
            background:var(--bg-secondary);
            color:white;
            border-color:var(--accent);
            box-shadow:none;
        }

        /* contador */

        .selected-count{
            margin-top:15px;
            font-size:14px;
            color:var(--text-secondary);
        }

        /* panel derecho */

        .movie-panel{
            background:var(--bg-card);
            border:1px solid var(--border-color);
            border-radius:14px;
            padding:20px;
        }

        /* buscador */

        .movie-search{
            margin-bottom:18px;
        }

        /* grid */

        .movie-grid{
            display:grid;
            grid-template-columns:repeat(auto-fill,minmax(150px,1fr));
            gap:14px;
        }

        /* card */

        .movie-card{
            background:var(--bg-secondary);
            border:2px solid transparent;
            border-radius:10px;
            overflow:hidden;
            cursor:pointer;
            transition:all .18s ease;
        }

        .movie-card:hover{
            transform:translateY(-3px);
            border-color:var(--accent);
        }

        .movie-card.selected{
            border-color:var(--accent);
            box-shadow:0 0 12px rgba(250,204,21,.4);
        }

        .movie-poster{
            width:100%;
            height:200px;
            object-fit:cover;
        }

        .movie-title{
            padding:8px;
            font-size:.85rem;
            font-weight:600;
            text-align:center;
        }

        /* botones */

        .save-btn{
            width:100%;
            margin-top:20px;
        }

    </style>
{% endblock %}

{% block body %}

    <div class="page-header">

        <div class="page-title">
            Nueva categoría
        </div>

        <div class="page-subtitle">
            Crea una nueva categoría y selecciona las películas que la compondrán
        </div>

    </div>


    {{ form_start(form) }}

    <div class="category-layout">

        <!-- PANEL IZQUIERDO -->
        <div class="category-panel">

            <div class="mb-3">
                <label class="form-label">
                    Nombre
                </label>

                {{ form_widget(form.name,{
                    attr:{
                        class:"form-control",
                        placeholder:"Ej: Mejores películas de Nolan"
                    }
                }) }}
            </div>


            <div class="mb-3">
                <label class="form-label">
                    Descripción
                </label>

                {{ form_widget(form.description,{
                    attr:{
                        class:"form-control",
                        rows:4,
                        placeholder:"Describe la categoría..."
                    }
                }) }}
            </div>


            <div class="selected-count">
                Películas seleccionadas:
                <strong id="selected-count">0</strong>
            </div>


            <button class="btn btn-accent save-btn">
                Crear categoría
            </button>

        </div>



        <!-- PANEL DERECHO -->
        <div class="movie-panel">

            <input
                    type="text"
                    id="movie-search"
                    class="form-control movie-search"
                    placeholder="Buscar película..."
            >


            <div class="movie-grid" id="movies-container">

                {% for movie in movies %}

                    <div class="movie-wrapper"
                         data-title="{{ movie.title|lower }}">

                        <div class="movie-card"
                             onclick="toggleMovie({{ movie.id }})"
                             id="card-{{ movie.id }}">

                            {% if movie.posterUrl %}

                                <img src="{{ movie.posterUrl }}"
                                     class="movie-poster">

                            {% endif %}

                            <div class="movie-title">
                                {{ movie.title }}
                            </div>

                        </div>


                        <input
                                type="checkbox"
                                name="selected_movies[]"
                                value="{{ movie.id }}"
                                id="movie-{{ movie.id }}"
                                style="display:none;">

                    </div>

                {% endfor %}

            </div>

        </div>

    </div>

    {{ form_end(form) }}

{% endblock %}



{% block javascripts %}

    <script>

        let selectedCount = 0;

        function toggleMovie(id)
        {
            const checkbox =
                document.getElementById('movie-' + id);

            const card =
                document.getElementById('card-' + id);


            checkbox.checked = !checkbox.checked;

            if(checkbox.checked)
            {
                card.classList.add('selected');
                selectedCount++;
            }
            else
            {
                card.classList.remove('selected');
                selectedCount--;
            }

            updateCount();
        }


        function updateCount()
        {
            document.getElementById('selected-count')
                .innerText = selectedCount;
        }


        /* buscador */

        document.getElementById('movie-search')
            .addEventListener('input',function()
            {

                const value =
                    this.value.toLowerCase();

                document.querySelectorAll('.movie-wrapper')
                    .forEach(function(movie)
                    {

                        const title =
                            movie.dataset.title;

                        movie.style.display =
                            title.includes(value)
                                ? ''
                                : 'none';

                    });

            });

    </script>

{% endblock %}