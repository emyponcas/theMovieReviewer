{% extends 'base.html.twig' %}

{% block title %}Pel칤culas Populares - MovieRank{% endblock %}

{% block stylesheets %}
    <style>
        :root{
            --bg-0: #070A0F;
            --bg-1: #0B1020;

            --stroke: rgba(255,255,255,.14);
            --stroke-2: rgba(255,255,255,.22);

            --text: rgba(255,255,255,.92);
            --muted: rgba(255,255,255,.65);

            --card-front: rgba(255,255,255,.06);
            --card-back: rgba(255,255,255,.07);

            --shadow: 0 18px 55px rgba(0,0,0,.65);
        }

        body{
            background:
                    radial-gradient(1200px 700px at 20% -10%, rgba(95,251,255,.08) 0%, transparent 55%),
                    radial-gradient(900px 600px at 85% 0%, rgba(165,92,255,.08) 0%, transparent 55%),
                    radial-gradient(900px 700px at 60% 110%, rgba(255,214,102,.05) 0%, transparent 55%),
                    linear-gradient(180deg, var(--bg-0), var(--bg-1));
            color: var(--text);
        }

        .text-muted{ color: var(--muted) !important; }
        .lead{ color: rgba(255,255,255,.75); }

        .movie-item{
            perspective: 1400px;
        }

        .movie-card{
            position: relative;
            border-radius: 18px;
            height: 540px;
        }

        .movie-card-inner{
            position: absolute;
            inset: 0;
            border-radius: 18px;
            transform-style: preserve-3d;
            transition: transform 700ms cubic-bezier(.2,.8,.2,1);
            will-change: transform;
        }

        .movie-card:hover .movie-card-inner,
        .movie-card:focus-within .movie-card-inner{
            transform: rotateY(180deg);
        }

        .movie-face{
            position: absolute;
            inset: 0;
            border-radius: 18px;
            overflow: hidden;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            border: 1px solid var(--stroke);
            box-shadow: var(--shadow);
        }

        .movie-front{
            background: linear-gradient(180deg, var(--card-front), rgba(255,255,255,.03));
        }

        .movie-front .poster{
            position: absolute;
            inset: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: translateZ(0);
        }

        .movie-front::after{
            content:"";
            position:absolute;
            inset:0;
            background:
                    radial-gradient(120% 90% at 50% 12%, rgba(255,255,255,.10) 0%, transparent 55%),
                    radial-gradient(110% 90% at 50% 115%, rgba(0,0,0,.70) 0%, transparent 55%),
                    linear-gradient(180deg, rgba(0,0,0,.08), rgba(0,0,0,.28));
            pointer-events:none;
        }

        .movie-badges{
            position: absolute;
            top: 12px;
            left: 12px;
            right: 12px;
            display: flex;
            justify-content: space-between;
            gap: 10px;
            z-index: 2;
            pointer-events: none;
        }

        .movie-rating,
        .movie-adult-badge{
            pointer-events: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 7px 10px;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,.16);
            background: rgba(0,0,0,.55);
            box-shadow: 0 10px 22px rgba(0,0,0,.35);
            font-weight: 800;
            font-size: .92rem;
        }

        .movie-rating{ color: #ffd36a; }
        .movie-adult-badge{
            background: linear-gradient(135deg, rgba(220,53,69,.95), rgba(255,107,107,.85));
            color: #fff;
            border-color: rgba(255,255,255,.18);
        }

        .movie-back{
            transform: rotateY(180deg);
            background:
                    radial-gradient(900px 420px at 20% 0%, rgba(95,251,255,.10) 0%, transparent 55%),
                    radial-gradient(900px 420px at 85% 10%, rgba(165,92,255,.10) 0%, transparent 55%),
                    linear-gradient(180deg, var(--card-back), rgba(255,255,255,.03));
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-color: var(--stroke-2);
            display: flex;
            flex-direction: column;
        }

        .movie-back-header{
            padding: 16px 16px 0 16px;
        }

        .movie-back-title{
            font-weight: 800;
            letter-spacing: .2px;
            margin-bottom: 6px;
        }

        .movie-back-meta{
            color: var(--muted);
            font-size: .95rem;
            display: flex;
            gap: 14px;
            flex-wrap: wrap;
            margin-bottom: 10px;
        }

        .movie-back-body{
            padding: 0 16px 12px 16px;
            color: rgba(255,255,255,.86);
        }

        .movie-overview{
            margin: 0;
            line-height: 1.4;
        }

        .movie-back-footer{
            margin-top: auto;
            padding: 14px 16px 16px 16px;
            border-top: 1px solid rgba(255,255,255,.10);
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 12px;
        }

        .btn{ border-radius: 999px; }
        .btn-outline-primary{
            border-color: rgba(95,251,255,.45);
            color: rgba(95,251,255,.92);
        }
        .btn-outline-primary:hover{
            background: rgba(95,251,255,.12);
            border-color: rgba(95,251,255,.65);
            color: rgba(255,255,255,.95);
        }
        .btn-outline-warning{
            border-color: rgba(255,214,102,.55);
            color: rgba(255,214,102,.92);
        }
        .btn-outline-warning:hover{
            background: rgba(255,214,102,.12);
            border-color: rgba(255,214,102,.75);
            color: rgba(255,255,255,.95);
        }

        .no-poster{
            position:absolute;
            inset:0;
            display:flex;
            align-items:center;
            justify-content:center;
            text-align:center;
            padding: 18px;
            background:
                    radial-gradient(500px 260px at 30% 10%, rgba(95,251,255,.14) 0%, transparent 60%),
                    radial-gradient(420px 260px at 80% 20%, rgba(165,92,255,.14) 0%, transparent 60%),
                    linear-gradient(135deg, rgba(255,255,255,.08) 0%, rgba(255,255,255,.03) 100%);
            color: rgba(255,255,255,.92);
            border-bottom: 1px solid rgba(255,255,255,.10);
        }

        @media (prefers-reduced-motion: reduce){
            .movie-card-inner{ transition: none !important; }
        }
    </style>
{% endblock %}

{% block body %}
    <div class="container mt-4">
        <div class="row mb-4">
            <div class="col-12">
                <h1 class="display-4 fw-bold">
                    <i class="fas fa-film text-primary"></i> Pel칤culas Populares
                </h1>
                <p class="lead">Descubre y valora las pel칤culas m치s populares de TMDB</p>

                <div class="row g-3 mb-3">
                    <div class="col-md-4 col-6">
                        <div class="card bg-primary text-white">
                            <div class="card-body text-center">
                                <h5 class="card-title">
                                    <i class="fas fa-video"></i> Total
                                </h5>
                                <p class="card-text display-6">{{ movies|length }}</p>
                                <small>Pel칤culas</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-6">
                        <div class="card bg-success text-white">
                            <div class="card-body text-center">
                                <h5 class="card-title">
                                    <i class="fas fa-calendar-alt"></i> A침o
                                </h5>
                                <p class="card-text display-6">{{ "now"|date("Y") }}</p>
                                <small>Actual</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 col-6">
                        <div class="card bg-info text-white">
                            <div class="card-body text-center">
                                <h5 class="card-title">
                                    <i class="fas fa-database"></i> Estado
                                </h5>
                                <p class="card-text display-6">
                                    {% if movies|length > 0 %}
                                        OK
                                    {% else %}
                                        Vac칤a
                                    {% endif %}
                                </p>
                                <small>Base de datos</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {# Grid de pel칤culas #}
        <div class="row g-4" id="moviesGrid">
            {% if movies is empty %}
                <div class="col-12">
                    <div class="alert alert-warning text-center">
                        <i class="fas fa-film fa-2x mb-3"></i>
                        <h4>No hay pel칤culas disponibles</h4>
                        <p>La base de datos est치 vac칤a. Necesitas importar datos desde TMDB.</p>
                    </div>
                </div>
            {% endif %}

            {% for movie in movies %}
                <div class="col-xl-3 col-lg-4 col-md-6 col-sm-6 mb-4 movie-item">
                    <div class="movie-card" tabindex="0" aria-label="Tarjeta de {{ movie.title|default('pel칤cula') }}">
                        <div class="movie-card-inner">
                            {# FRONT (solo imagen) #}
                            <div class="movie-face movie-front">
                                <div class="movie-badges">
                                    <div>
                                        {% if movie.adult %}
                                            <span class="movie-adult-badge">游 +18</span>
                                        {% endif %}
                                    </div>

                                    <div class="movie-rating">
                                        <i class="fas fa-star"></i>
                                        {% if movie.voteAverage %}
                                            {{ movie.voteAverage|number_format(1) }}
                                        {% else %}
                                            N/A
                                        {% endif %}
                                    </div>
                                </div>

                                {% if movie.posterUrl %}
                                    <img
                                            src="https://image.tmdb.org/t/p/w500{{ movie.posterUrl }}"
                                            class="poster"
                                            alt="{{ movie.title }}"
                                            loading="lazy"
                                    >
                                {% else %}
                                    <div class="no-poster">
                                        <div>
                                            <i class="fas fa-film fa-3x mb-2"></i>
                                            <div class="fw-bold">{{ movie.title|default('Sin t칤tulo') }}</div>
                                            <div class="text-muted">Sin p칩ster</div>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>

                            {# BACK (info) #}
                            <div class="movie-face movie-back">
                                <div class="movie-back-header">
                                    <div class="movie-back-title h5 mb-1">
                                        {{ movie.title|default('Sin t칤tulo') }}
                                    </div>

                                    <div class="movie-back-meta">
                                        <span>
                                            <i class="fas fa-calendar-alt"></i>
                                            {% if movie.releaseDate %}
                                                {{ movie.releaseDate|date('Y') }}
                                            {% else %}
                                                Sin fecha
                                            {% endif %}
                                        </span>

                                        <span>
                                            <i class="fas fa-thumbs-up"></i>
                                            {% if movie.voteCount %}
                                                {{ movie.voteCount }} votos
                                            {% else %}
                                                0 votos
                                            {% endif %}
                                        </span>

                                        <span>
                                            <i class="fas fa-chart-line"></i>
                                            {% if movie.popularity %}
                                                {{ movie.popularity|number_format(0) }}
                                            {% else %}
                                                0
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>

                                <div class="movie-back-body">
                                    <p class="movie-overview">
                                        {% if movie.overview %}
                                            {{ movie.overview|slice(0, 260) }}...
                                        {% else %}
                                            <span class="text-muted">Sin descripci칩n disponible.</span>
                                        {% endif %}
                                    </p>
                                </div>

                                <div class="movie-back-footer">
                                    <button class="btn btn-outline-primary btn-sm" disabled title="Pr칩ximamente">
                                        <i class="fas fa-info-circle"></i> Detalles
                                    </button>

                                    <button class="btn btn-outline-warning btn-sm" disabled title="Inicia sesi칩n para valorar">
                                        <i class="fas fa-star"></i> Valorar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
{% endblock %}

{% block javascripts %}
    <script>
    </script>
{% endblock %}